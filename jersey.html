<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kit Search</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f4f6f8; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; }

        /* Navigation */
        .nav-bar { position: relative; display: flex; justify-content: center; align-items: center; margin-bottom: 40px; padding: 10px 0; }
        .nav-center { display: flex; gap: 20px; }
        .nav-link { text-decoration: none; color: #4b5563; font-weight: 600; padding: 8px 16px; border-radius: 6px; font-size: 16px; transition: 0.2s; }
        .nav-link:hover { background-color: #e5e7eb; color: #111827; }
        .nav-link.active { background-color: #2ecc71; color: white; }
        .supervisor-link { position: absolute; right: 0; top: 50%; transform: translateY(-50%); text-decoration: none; color: #2c3e50; font-size: 0.9rem; font-weight: 600; border: 1px solid #d1d5db; padding: 6px 12px; border-radius: 4px; background: white; transition: all 0.2s; }
        .supervisor-link:hover { background: #f3f4f6; border-color: #9ca3af; }
        @media (max-width: 800px) {
            .nav-bar { flex-direction: column; gap: 15px; }
            .supervisor-link { position: static; transform: none; margin-left: auto; }
            .nav-center { flex-wrap: wrap; justify-content: center; }
        }

        /* --- SEARCH STYLES --- */
        .search-container { position: relative; max-width: 600px; margin: 0 auto 20px auto; }
        
        .search-box { 
            width: 100%; padding: 15px 20px; font-size: 1.1rem; border: 2px solid #ddd; 
            border-radius: 30px; outline: none; transition: border-color 0.2s; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .search-box:focus { border-color: #2ecc71; }

        /* Autocomplete Dropdown */
        .search-results {
            position: absolute; top: 110%; left: 0; right: 0; background: white;
            border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
            max-height: 300px; overflow-y: auto; z-index: 100; display: none;
            border: 1px solid #eee;
        }
        .result-item {
            padding: 12px 20px; cursor: pointer; border-bottom: 1px solid #f0f0f0;
            font-size: 1rem; color: #444; transition: background 0.1s;
        }
        .result-item:last-child { border-bottom: none; }
        .result-item:hover { background-color: #f0fdf4; color: #2ecc71; font-weight: 500; }
        .no-results { padding: 15px; text-align: center; color: #888; font-style: italic; }

        /* --- LARGE DETAIL VIEW --- */
        #detailView { display: none; animation: fadeIn 0.3s ease; }
        
        .school-header { text-align: center; margin-bottom: 30px; }
        .school-title { font-size: 2.5rem; color: #2c3e50; margin: 0; }
        .school-subtitle { color: #7f8c8d; font-size: 1.1rem; margin-top: 5px; }

        .kits-display { 
            display: flex; justify-content: center; gap: 40px; flex-wrap: wrap; 
            background: white; padding: 40px; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); border: 1px solid #eee;
        }

        .kit-group { text-align: center; width: 180px; }
        .kit-label { 
            display: block; font-weight: 800; font-size: 1.2rem; color: #2c3e50; 
            margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;
        }
        
        /* The SVG itself */
        .kit-svg { 
            width: 150px; height: 220px; 
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.15));
            transition: transform 0.2s;
        }
        .kit-svg:hover { transform: scale(1.05); }

        .kit-updated { 
            font-size: 0.85rem; color: #999; margin-top: 15px; 
            font-style: italic; display: flex; align-items: center; justify-content: center; gap: 5px;
        }

        /* Reset Button */
        .reset-container { text-align: center; margin-top: 30px; }
        .btn-reset { 
            background: #e2e8f0; color: #4a5568; border: none; padding: 10px 20px; 
            border-radius: 30px; cursor: pointer; font-weight: 600;
        }
        .btn-reset:hover { background: #cbd5e1; }

        /* Edit Button */
        .edit-link {
            display: inline-block; margin-top: 20px; color: #3498db; text-decoration: underline; 
            cursor: pointer; font-size: 0.9rem;
        }

        /* Loading */
        #loading { text-align: center; color: #666; font-style: italic; margin-top: 20px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal { background: white; width: 90%; max-width: 600px; padding: 25px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .modal h2 { margin-top: 0; color: #2c3e50; font-size: 1.5rem; }
        .modal-label { display: block; font-size: 0.85rem; font-weight: bold; color: #666; margin-top: 10px; }
        .modal-input { width: 100%; padding: 8px; margin-top: 4px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        .modal-actions { margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px; }
        .btn-cancel { background: #e0e0e0; color: #333; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
        .btn-submit { background: #2ecc71; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <div class="nav-bar">
            <div class="nav-center">
                <a href="index.html" class="nav-link">Home</a>
                <a href="report.html" class="nav-link">CMI Form</a>
                <span class="nav-link active">Kit Search</span>
                <a href="quizzes.html" class="nav-link">Training Quizzes</a>
            </div>
            <a href="admin.html" class="supervisor-link">üîí Supervisors</a>
        </div>

        <div id="searchView">
            <h1 style="text-align:center; color:#2c3e50; font-size: 2.5rem; margin-bottom: 10px;">Kit Color Search</h1>
            <p style="text-align:center; color:#7f8c8d; margin-bottom:40px; font-size: 1.1rem;">Search for a school to view their official home and away kits.</p>

            <div class="search-container">
                <input type="text" id="searchInput" class="search-box" placeholder="Start typing a school name..." onkeyup="handleTyping()" autocomplete="off">
                <div id="resultsList" class="search-results"></div>
            </div>
            <div id="loading">Loading Database...</div>
        </div>

        <div id="detailView">
            <div class="reset-container" style="text-align:left; margin-bottom:20px; margin-top:0;">
                <button class="btn-reset" onclick="resetSearch()">‚Üê Back to Search</button>
            </div>

            <div class="school-header">
                <h1 id="viewSchoolName" class="school-title">School Name</h1>
                <div id="viewAssociation" class="school-subtitle">Association Name</div>
            </div>

            <div id="kitsContainer" class="kits-display">
                </div>

            <div style="text-align:center;">
                <span class="edit-link" onclick="openModal()">Request an Update for this School</span>
            </div>
        </div>
    </div>

    <div id="editModal" class="modal-overlay">
        <div class="modal">
            <h2>Request Update</h2>
            <p style="color:#666; font-size:0.9rem;">Suggest corrected colors for <strong id="modalSchoolName"></strong>.</p>
            <input type="hidden" id="modalSchoolInput">
            <label class="modal-label">Your Name</label>
            <input type="text" id="submitterName" class="modal-input" placeholder="e.g. John Doe">
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
                <div><label class="modal-label">Home Shirt</label><input type="text" id="hShirt" class="modal-input" placeholder="#HEX"></div>
                <div><label class="modal-label">Home Short</label><input type="text" id="hShort" class="modal-input"></div>
                <div><label class="modal-label">Home Sock</label><input type="text" id="hSock" class="modal-input"></div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
                <div><label class="modal-label">Away Shirt</label><input type="text" id="aShirt" class="modal-input" placeholder="#HEX"></div>
                <div><label class="modal-label">Away Short</label><input type="text" id="aShort" class="modal-input"></div>
                <div><label class="modal-label">Away Sock</label><input type="text" id="aSock" class="modal-input"></div>
            </div>
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal()">Cancel</button>
                <button class="btn-submit" onclick="submitEdit()">Submit Request</button>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwhPmP3cQQtep2d0uRgcSW9dPvVt9ppqk2KI2UBT0ZhKO4xOJx2ktMkvkzrotQNkBz-jg/exec"; 
        
        let schoolsData = [];
        let currentSchool = null;

        document.addEventListener('DOMContentLoaded', () => {
            fetch(`${SCRIPT_URL}?action=getJerseyData`)
                .then(res => res.json())
                .then(data => {
                    if (!Array.isArray(data)) { console.error("Invalid Data"); return; }
                    schoolsData = data;
                    document.getElementById('loading').style.display = 'none';
                });
        });

        // 1. SEARCH LOGIC
        function handleTyping() {
            const input = document.getElementById('searchInput');
            const list = document.getElementById('resultsList');
            const term = input.value.toLowerCase();
            
            if (term.length < 2) {
                list.style.display = 'none';
                return;
            }

            const matches = schoolsData.filter(s => (s.school || "").toLowerCase().includes(term));
            
            list.innerHTML = '';
            if (matches.length === 0) {
                list.innerHTML = '<div class="no-results">No schools found</div>';
            } else {
                matches.forEach(school => {
                    const item = document.createElement('div');
                    item.className = 'result-item';
                    item.innerText = school.school;
                    item.onclick = () => selectSchool(school);
                    list.appendChild(item);
                });
            }
            list.style.display = 'block';
        }

        // 2. SELECTION LOGIC
        function selectSchool(school) {
            currentSchool = school;
            
            // Populate View
            document.getElementById('viewSchoolName').innerText = school.school;
            document.getElementById('viewAssociation').innerText = "Official Kit Colors";

            const container = document.getElementById('kitsContainer');
            container.innerHTML = `
                ${createKitSvg("Home", school.hShirt, school.hAccent, school.hShort, school.hSock, school.hUpdate)}
                ${createKitSvg("Away", school.aShirt, school.aAccent, school.aShort, school.aSock, school.aUpdate)}
            `;

            if(school.tShirt && school.tShirt !== "") {
                container.innerHTML += createKitSvg("Alternate", school.tShirt, school.tAccent, school.tShort, school.tSock, school.tUpdate);
            }

            // Switch Views
            document.getElementById('searchView').style.display = 'none';
            document.getElementById('detailView').style.display = 'block';
        }

        function resetSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('resultsList').style.display = 'none';
            document.getElementById('detailView').style.display = 'none';
            document.getElementById('searchView').style.display = 'block';
            document.getElementById('searchInput').focus();
        }

        // 3. SVG GENERATOR (With Accent Number 10)
        function createKitSvg(label, shirt, accent, shorts, socks, updated) {
            // Defaults
            const cShirt = shirt || "#ffffff";
            const cAccent = accent || "#000000"; // The number 10 color
            const cShort = shorts || "#ffffff";
            const cSock = socks || "#ffffff";

            const svgHtml = `
            <svg class="kit-svg" viewBox="0 0 100 160" xmlns="http://www.w3.org/2000/svg">
                <path d="M20,10 L80,10 L95,35 L80,45 L75,35 L75,90 L25,90 L25,35 L20,45 L5,35 Z" 
                      fill="${cShirt}" stroke="#333" stroke-width="0.5"/>
                
                <text x="50" y="60" font-family="Arial, sans-serif" font-size="30" font-weight="900" 
                      fill="${cAccent}" text-anchor="middle" dominant-baseline="middle">10</text>

                <path d="M25,95 L75,95 L80,130 L50,130 L50,110 L50,130 L20,130 Z" 
                      fill="${cShort}" stroke="#333" stroke-width="0.5"/>

                <rect x="25" y="135" width="15" height="25" fill="${cSock}" stroke="#333" stroke-width="0.5" rx="2"/>
                <rect x="60" y="135" width="15" height="25" fill="${cSock}" stroke="#333" stroke-width="0.5" rx="2"/>
            </svg>
            `;

            return `
                <div class="kit-group">
                    <span class="kit-label" style="color:${cShirt === '#ffffff' ? '#333' : cShirt}">${label}</span>
                    ${svgHtml}
                    <div class="kit-updated">üìÖ Updated: ${updated || "N/A"}</div>
                </div>
            `;
        }

        // 4. MODAL LOGIC
        function openModal() {
            if(!currentSchool) return;
            document.getElementById('modalSchoolName').innerText = currentSchool.school;
            document.getElementById('modalSchoolInput').value = currentSchool.school;
            document.getElementById('editModal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('editModal').style.display = 'none'; }
        
        function submitEdit() {
            const btn = document.querySelector('.btn-submit');
            btn.innerText = "Sending..."; btn.disabled = true;
            const payload = {
                type: 'jersey_edit',
                submittedBy: document.getElementById('submitterName').value,
                school: document.getElementById('modalSchoolInput').value,
                homeShirt: document.getElementById('hShirt').value,
                homeShort: document.getElementById('hShort').value,
                homeSock: document.getElementById('hSock').value,
                awayShirt: document.getElementById('aShirt').value,
                awayShort: document.getElementById('aShort').value,
                awaySock: document.getElementById('aSock').value
            };
            fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) })
            .then(() => { alert("Success! Request submitted."); closeModal(); btn.innerText = "Submit Request"; btn.disabled = false; })
            .catch(() => { alert("Error sending request."); btn.innerText = "Submit Request"; btn.disabled = false; });
        }
    </script>
</body>
</html>
